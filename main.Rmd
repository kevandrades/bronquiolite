---
title: "Tratamentos com oxigenoterapia em pacientes com bronquiolite"
runningheader: "Tratamentos com oxigenoterapia em pacientes com bronquiolite" # only for pdf output
subtitle: "Diferenças entre os grupos de tratamento" # only for html output
author:
- name: Kevyn Andrade
- name: Rayssa Souza 
  affiliation: Universidade de Brasília
date: "`r Sys.Date()`"
output:
  tufte::tufte_html: default
  tufte::tufte_handout:
    citation_package: natbib
    latex_engine: xelatex
  tufte::tufte_book:
    citation_package: natbib
    latex_engine: xelatex
bibliography: skeleton.bib
link-citations: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    cache = TRUE,
    message = FALSE, warning = FALSE,
    fig.path = "figs/",
    cache.path = "_cache/",
    fig.process = function(x) {
        x2 <- sub("-\\d+([.][a-z]+)$", "\\1", x)
        if (file.rename(x, x2)) x2 else x
    }
)
```

```{r, echo = FALSE}
source("src/packages.R")
```
```{r, include = FALSE}
# reading dataset
bronquiolite <- read_csv("data/bronquiolite.csv")
```
# Metodologia
* Nível de significância para todos os testes: 0,05;
* O teste de Fisher foi escolhido nas tabelas onde alguma célula possuía frequência esperada menor que 5;

# Variáveis Qualitativas

## Presença de reinternações por grupo de tratamento

```{r, warning = FALSE}
bronquiolite[, c("Reinternações", "Grupo")] %>%
  table() %>%
  chisq.test()
```

O p-valor obtido é muito alto, de modo que não há evidências
de associação entre tipo de tratamento com e a presença
de reinternações.

## Grau de desconforto respiratório por grupo de tratamento

```{r, warning = FALSE}
bronquiolite[, c("Desconforto", "Grupo")] %>%
    table() %>%
    chisq.test()
```
O p valor foi extremamente pequeno, mostrando evidências de que o tipo de tratamento
está ligado ao grau de desconforto do paciente.

Verificando qual tratamento apresenta mais casos graves de desconforto respiratório:

```{r, warning = FALSE}
bronquiolite[, c("Desconforto", "Grupo")] %>%
  table() %>%
  prop.table(margin = 2)
```

O tratamento de "Oxigenoterapia + Outros" tem mais casos graves em relação ao tratamento
de "Oxigenoterapia", de modo que "Oxigenoterapia + Outros" apresenta um maior grau de
desconforto.

## Melhora nos sinais de desconforto respiratório

```{r, warning = FALSE}
bronquiolite[, c("Melhora dos sinais de desconforto respiratório", "Grupo")] %>%
  table() %>%
  fisher.test()
```

Não há evidência significativa de associação entre tipo de tratamento e melhora
nos sinais de desconforto respiratório.

## Presença de Complicações
```{r, warning = FALSE}
bronquiolite[, c("Complicações", "Grupo")] %>%
    table() %>%
    fisher.test()
```

Não existe evidência significativa de associação entre tipo de tratamento
e a presença de complicações.


# Variáveis Quantitativas

## Tempo de internação
```{r, warning = FALSE}
bronquiolite %$%
  shapiro.test(Tempo)
```
Dado que há evidências contra a hipótese de normalidade, será usado o teste de
Mann-Whitney-Wilcoxon.

```{r, warning = FALSE}
wilcox.test(Tempo ~ Grupo, bronquiolite)
```

Não há evidências de associação significativa entre tipo de tratamento
e tempo de internação.

```{r, warning = FALSE}
ggplot(bronquiolite) +
  aes(x = Grupo, y = Tempo) +
  geom_boxplot(fill = c("#A9A9A9"), width = 0.5) +
  stat_summary(
    fun = "mean", geom = "point",
    shape = 23, size = 3,
    fill = "white"
  ) +
  labs(x = "Tipo de Tratamento", y = "Tempo de Internação") +
  theme_bw()
#ggsave("tempo_tratamento.pdf", width = 170, height = 95, units = "mm")
```

## Quantidade de Litros de Oxigênio

```{r, warning = FALSE}
bronquiolite %$%
  shapiro.test(Oxigênio)
```
Há evidências contra a hipótese de normalidade. Será usado o teste de Mann-Whitney-Wilcoxon.

```{r, warning = FALSE}
wilcox.test(Oxigênio ~ Grupo, bronquiolite)
```

Há evidências de associação entre tipo de tratamento e a quantidade de litros de oxigênio.

## Melhora na Saturação de Oxigênio

```{r, warning = FALSE}
bronquiolite %$%
  shapiro.test(Saturação)
```

Há evidências contra a hipótese de normalidade da saturação.

```{r, warning = FALSE}
wilcox.test(Saturação ~ Grupo, bronquiolite)
```

Não há evidências de associação do tipo de tratamento com a melhora na saturação de oxigênio.

```{r}
pacman::p_load(knitr, kableExtra)
df <- data.frame(Cat = c("Short", "Tall"), 
                 Sad = linebreak(c("Sam\nBeth", "Erin\nTed")), 
                 Happy = linebreak(c("Jim\nSara", "Bob\nAva")))
kable(df, col.names = c("", "Sad", "Happy"), escape = F, caption = "My caption") %>%

kable_styling(latex_options = "hold_position")
```